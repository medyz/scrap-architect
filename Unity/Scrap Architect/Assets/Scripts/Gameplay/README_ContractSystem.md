# Система контрактов и целей

## Обзор

Система контрактов обеспечивает игровой прогресс в "Scrap Architect" через выполнение различных задач. Игроки могут принимать контракты, выполнять цели и получать награды в виде скрапа, опыта и разблокировки новых деталей.

## Компоненты системы

### 1. Contract - Основной класс контракта
**Файл:** `Contract.cs`

Основной класс, определяющий структуру и логику контрактов.

**Основные функции:**
- Управление состоянием контракта (Available, Active, Completed, Failed, Expired)
- Отслеживание прогресса выполнения целей
- Расчет наград и бонусов
- Проверка требований и времени выполнения

**Ключевые свойства:**
- `contractID` - Уникальный идентификатор контракта
- `title` - Название контракта
- `description` - Описание задачи
- `contractType` - Тип контракта (Delivery, Transport, Construction и т.д.)
- `difficulty` - Сложность (Easy, Medium, Hard, Expert, Master)
- `status` - Текущее состояние контракта
- `objectives` - Список целей для выполнения
- `reward` - Награды за выполнение
- `timeLimit` - Ограничение по времени

**Типы контрактов:**
- **Delivery** - Доставка груза из точки A в точку B
- **Transport** - Перевозка пассажиров
- **Construction** - Строительство структур
- **Collection** - Сбор предметов
- **Destruction** - Уничтожение объектов
- **Racing** - Гонки с чекпоинтами
- **Exploration** - Исследование областей
- **Rescue** - Спасение пострадавших

### 2. ContractObjective - Цель контракта
**Файл:** `Contract.cs` (вложенный класс)

Определяет отдельные цели в рамках контракта.

**Основные функции:**
- Отслеживание прогресса выполнения
- Проверка завершения цели
- Расчет процента выполнения

**Типы целей:**
- **ReachLocation** - Достичь определенной локации
- **CollectItems** - Собрать указанное количество предметов
- **DeliverItems** - Доставить предметы в пункт назначения
- **DestroyObjects** - Уничтожить объекты
- **BuildStructure** - Построить структуру
- **TravelDistance** - Проехать определенное расстояние
- **ReachSpeed** - Достичь указанной скорости
- **SurviveTime** - Выжить определенное время
- **UseTool** - Использовать инструмент
- **ConnectParts** - Соединить детали

### 3. ContractReward - Награды контракта
**Файл:** `Contract.cs` (вложенный класс)

Определяет награды за выполнение контракта.

**Свойства:**
- `scrapReward` - Количество скрапа
- `experienceReward` - Количество опыта
- `unlockParts` - Список разблокируемых деталей
- `unlockTools` - Список разблокируемых инструментов
- `reputationGain` - Прирост репутации

### 4. ContractManager - Менеджер контрактов
**Файл:** `ContractManager.cs`

Управляет всеми контрактами в игре.

**Основные функции:**
- Генерация случайных контрактов
- Управление доступными и активными контрактами
- Обновление состояния контрактов
- Автоматическое обновление доступных контрактов
- Интеграция с UI системой

**Ключевые свойства:**
- `maxActiveContracts` - Максимальное количество активных контрактов
- `maxAvailableContracts` - Максимальное количество доступных контрактов
- `contractRefreshInterval` - Интервал обновления контрактов
- `autoGenerateContracts` - Автоматическая генерация контрактов

**Генерация контрактов:**
- **Вероятности сложности:** Настраиваемые шансы для каждой сложности
- **Случайные позиции:** Автоматическое размещение точек старта/финиша
- **Динамические награды:** Награды зависят от сложности и расстояния
- **Разнообразие типов:** Случайный выбор типа контракта

### 5. ContractListItem - UI элемент контракта
**Файл:** `ContractListItem.cs`

UI элемент для отображения контракта в списке.

**Основные функции:**
- Отображение информации о контракте
- Кнопки принятия/отмены контракта
- Отображение прогресса выполнения
- Визуальная обратная связь

**Визуальные элементы:**
- **Цветовая схема сложности:** Разные цвета для разных уровней сложности
- **Прогресс-бар:** Визуализация прогресса выполнения
- **Таймер:** Отображение оставшегося времени
- **Кнопки действий:** Принять, отменить, информация

## Процесс работы с контрактами

### 1. Генерация контрактов
1. **Инициализация:** При запуске игры генерируется начальный набор контрактов
2. **Автообновление:** Каждые 5 минут (настраивается) обновляется список доступных контрактов
3. **Случайность:** Тип, сложность и параметры контракта выбираются случайно
4. **Баланс:** Система обеспечивает разнообразие и сбалансированность контрактов

### 2. Принятие контракта
1. **Проверка требований:** Проверяется возможность принятия контракта
2. **Ограничения:** Проверяется лимит активных контрактов
3. **Активация:** Контракт переходит в состояние Active
4. **Подписка на события:** Менеджер подписывается на события контракта
5. **UI обновление:** Обновляется интерфейс

### 3. Выполнение контракта
1. **Отслеживание целей:** Система отслеживает прогресс каждой цели
2. **Обновление прогресса:** Регулярное обновление состояния контракта
3. **Проверка времени:** Контроль временных ограничений
4. **Завершение:** Автоматическое завершение при выполнении всех целей

### 4. Завершение контракта
1. **Успешное завершение:** Все обязательные цели выполнены
2. **Провал:** Истекло время или нарушены условия
3. **Награды:** Выдача наград игроку
4. **Очистка:** Удаление контракта из активных

## Интеграция с другими системами

### GameManager
- Управление состоянием игры
- Переключение между режимами (строительство, тестирование, контракты)

### UIManager
- Отображение панелей контрактов
- Обновление UI при изменении состояния контрактов

### PlayerProgress
- Отслеживание прогресса игрока
- Сохранение выполненных контрактов
- Разблокировка новых возможностей

### VehicleController
- Проверка требований к транспортному средству
- Отслеживание характеристик для целей

## Оптимизация

### Производительность
- **Кэширование:** Кэширование ссылок на компоненты
- **Обновления:** Оптимизированные циклы обновления
- **События:** Использование событий вместо постоянных проверок

### Память
- **Очистка:** Автоматическая очистка завершенных контрактов
- **Пулы объектов:** Переиспользование UI элементов
- **Сериализация:** Эффективное сохранение данных контрактов

## Расширения

### Новые типы контрактов
1. Создать новый тип в enum `ContractType`
2. Добавить метод генерации в `ContractManager`
3. Реализовать логику в `Contract`

### Новые типы целей
1. Добавить новый тип в enum `ObjectiveType`
2. Реализовать логику отслеживания в соответствующих системах
3. Обновить UI для отображения

### Система достижений
- Интеграция с системой контрактов
- Отслеживание статистики выполнения
- Разблокировка специальных наград

### Мультиплеер
- Синхронизация контрактов между игроками
- Совместное выполнение задач
- Конкурентные контракты

## Отладка

### Логирование
- Подробные логи для всех операций с контрактами
- Отслеживание ошибок и исключений
- Статистика выполнения

### Инспектор
- Визуализация состояния контрактов в инспекторе
- Возможность ручного управления контрактами
- Тестовые функции

### Тестирование
- Unit тесты для основных функций
- Интеграционные тесты с UI
- Стресс-тесты для генерации контрактов
