# Система управления Scrap Architect

## Обзор

Система управления состоит из четырех основных компонентов:

1. **InputManager** - Главный координатор всех систем ввода
2. **CameraController** - Управление камерой
3. **PartManipulator** - Манипуляции с деталями
4. **GameController** - Управление транспортом

## InputManager

### Назначение
Главный менеджер ввода, координирующий все системы управления и обрабатывающий глобальные горячие клавиши.

### Основные функции
- Обработка глобальных горячих клавиш
- Переключение режимов игры
- Управление UI
- Отладочные функции

### Горячие клавиши

#### Глобальные
- `Escape` - Пауза/Возобновление
- `B` - Переключение режима строительства
- `T` - Режим тестирования
- `G` - Режим песочницы
- `M` - Главное меню

#### UI
- `Tab` - Переключение видимости UI
- `F1` - Справка
- `F2` - Настройки

#### Отладка
- `F3` - Отладочный режим
- `F12` - Скриншот

### Состояния игры
- **Building** - Режим строительства
- **Testing** - Режим тестирования
- **Playing** - Режим игры
- **Paused** - Пауза

## CameraController

### Назначение
Орбитальная камера с зумом, панорамированием и следованием за объектами.

### Основные функции
- Орбитальное вращение камеры
- Зум (приближение/отдаление)
- Панорамирование
- Следование за целью
- Плавные переходы

### Управление
- **Правая кнопка мыши** - Вращение камеры
- **Средняя кнопка мыши** - Панорамирование
- **Колесо мыши** - Зум
- **Пробел** - Сброс вида

### Настройки
- `rotationSpeed` - Скорость вращения
- `zoomSpeed` - Скорость зума
- `panSpeed` - Скорость панорамирования
- `smoothSpeed` - Плавность движений
- `minZoom` / `maxZoom` - Ограничения зума

### Методы
- `SetTarget(Transform)` - Установить цель для следования
- `SetFollowTarget(bool)` - Включить/выключить следование
- `ResetView()` - Сбросить вид камеры
- `MoveToPosition(Vector3, float)` - Плавное перемещение к позиции
- `GetWorldPointUnderCursor(float)` - Получить точку в мире под курсором

## PartManipulator

### Назначение
Контроллер для манипуляций с деталями: выбор, перемещение, вращение, соединение.

### Основные функции
- Выбор деталей
- Перетаскивание деталей
- Вращение деталей
- Соединение деталей
- Удаление и дублирование

### Управление
- **Левая кнопка мыши** - Выбор/Перетаскивание
- **Delete** - Удаление выбранной детали
- **D** - Дублирование выбранной детали
- **R** - Вращение выбранной детали

### Настройки
- `selectableLayers` - Слои для выбора
- `selectionRadius` - Радиус выбора
- `moveSpeed` - Скорость перемещения
- `rotateSpeed` - Скорость вращения
- `snapDistance` - Расстояние снэппинга
- `enableSnapping` - Включить снэппинг

### Снэппинг
Система автоматического соединения деталей при приближении их друг к другу.

### События
- `OnPartSelected` - Деталь выбрана
- `OnPartDeselected` - Выбор снят с детали
- `OnPartDeleted` - Деталь удалена

### Методы
- `SelectPart(PartController)` - Выбрать деталь
- `DeselectPart()` - Снять выбор
- `ClearAllParts()` - Очистить все детали

## GameController

### Назначение
Контроллер для управления транспортом: двигатели, колеса, руление.

### Основные функции
- Управление двигателями
- Управление колесами
- Руление транспорта
- Торможение
- Следование камеры за транспортом

### Управление транспортом
- **W** - Газ вперед
- **S** - Газ назад
- **A** - Руление влево
- **D** - Руление вправо
- **Пробел** - Тормоз
- **E** - Включить/выключить двигатель

### Управление камерой
- **F** - Следовать за транспортом
- **C** - Свободная камера

### Настройки
- `throttleSensitivity` - Чувствительность газа
- `steeringSensitivity` - Чувствительность руления
- `brakeForce` - Сила торможения

### Автоматическое обнаружение
Контроллер автоматически находит все моторы и колеса в сцене и добавляет их в списки управления.

### События
- `OnThrottleChanged` - Изменение газа
- `OnSteeringChanged` - Изменение руления
- `OnEngineStateChanged` - Изменение состояния двигателя

### Методы
- `ScanForVehicleParts()` - Сканировать детали транспорта
- `StopAllEngines()` - Остановить все двигатели
- `ResetControls()` - Сбросить управление

## Интеграция систем

### Инициализация
Все контроллеры автоматически находят друг друга при старте и устанавливают связи.

### События
Системы обмениваются событиями для координации действий:
- Выбор детали → Обновление UI
- Изменение режима → Переключение контроллеров
- Пауза → Отключение ввода

### Состояния игры
Каждый контроллер реагирует на изменения состояния игры:
- **Building** - Активен PartManipulator
- **Testing** - Активен GameController
- **Paused** - Отключен весь ввод

## Настройка

### Добавление в сцену
1. Создать пустой GameObject "InputManager"
2. Добавить компонент `InputManager`
3. Настроить горячие клавиши в инспекторе

### Настройка камеры
1. Выбрать Main Camera
2. Добавить компонент `CameraController`
3. Настроить параметры камеры

### Настройка манипулятора
1. Создать GameObject "PartManipulator"
2. Добавить компонент `PartManipulator`
3. Настроить слои и параметры

### Настройка игрового контроллера
1. Создать GameObject "GameController"
2. Добавить компонент `GameController`
3. Настроить чувствительность управления

## Расширение

### Добавление новых горячих клавиш
1. Добавить KeyCode в InputManager
2. Обработать в HandleGlobalInput()
3. Вызвать соответствующее событие

### Добавление новых типов деталей
1. Создать новый класс детали
2. Добавить обработку в PartManipulator
3. Обновить GameController при необходимости

### Кастомизация управления
Все параметры управления можно настроить через инспектор Unity без изменения кода.
