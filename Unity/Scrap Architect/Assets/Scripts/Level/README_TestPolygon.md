# Тестовый полигон - Система тестирования

## Обзор

Тестовый полигон - это основная система для тестирования построенных машин в игре "Scrap Architect". Система включает в себя полигон с препятствиями, систему целей, подсчет очков и UI для управления тестированием.

## Компоненты системы

### 1. TestPolygon - Основной полигон
Главный компонент, управляющий тестовой сценой.

**Основные функции:**
- Создание полигона с землей и границами
- Генерация случайных препятствий
- Создание стартовой и финишной точек
- Система целей и подсчета очков
- Управление состоянием теста

**Настройки:**
- `polygonSize` - Размер полигона (50x10x50 по умолчанию)
- `groundMaterial` - Материал земли
- `obstacleMaterial` - Материал препятствий
- `timeLimit` - Лимит времени (60 секунд)
- `obstacleCount` - Количество препятствий (10)

### 2. TestModeUI - Пользовательский интерфейс
UI для управления тестированием и отображения информации.

**Элементы интерфейса:**
- Кнопки управления (Старт/Стоп/Сброс)
- Отображение времени и счета
- Панель целей
- HUD с информацией о машине
- Панель результатов

### 3. VehicleController - Контроллер машины
Управляет состоянием и поведением тестируемой машины.

**Функции:**
- Отслеживание деталей машины
- Мониторинг скорости и здоровья
- Обнаружение поломок
- Подсчет пройденного расстояния

## Система целей

### Типы целей

1. **ReachPoint** - Достичь определенной точки
   - Цель: Добраться до финишной точки
   - Очки: 1000

2. **CompleteInTime** - Завершить за время
   - Цель: Уложиться в лимит времени
   - Очки: 500

3. **MinimizeParts** - Минимизировать детали
   - Цель: Использовать не более 10 деталей
   - Очки: 300

### Создание целей

```csharp
TestGoal mainGoal = new TestGoal
{
    goalType = GoalType.ReachPoint,
    targetPosition = finishPoint.position,
    description = "Добраться до финишной точки",
    points = 1000
};
```

## Система подсчета очков

### Формула подсчета

```
Общий счет = Временной счет + Счет за расстояние + Счет за эффективность
```

**Временной счет:**
```
Временной счет = (Лимит времени - Текущее время) × Множитель времени
```

**Счет за эффективность:**
```
Эффективность = Максимум(0, 100 - Количество деталей × 10)
Счет за эффективность = Эффективность × Множитель эффективности
```

### Множители

- `timeMultiplier` - Множитель времени (1.0)
- `distanceMultiplier` - Множитель расстояния (1.0)
- `efficiencyMultiplier` - Множитель эффективности (1.5)

## Управление тестом

### Основные команды

```csharp
// Начать тест
testPolygon.StartTest();

// Остановить тест
testPolygon.StopTest();

// Сбросить тест
testPolygon.ResetTest();
```

### Состояния теста

- **Готов** - Тест не запущен
- **Активен** - Тест выполняется
- **Завершен** - Тест завершен успешно
- **Провален** - Тест провален

## Интеграция с другими системами

### GameController
Тестовый полигон интегрируется с системой управления для:
- Отслеживания состояния машины
- Получения данных о скорости
- Управления двигателями и колесами

### UIManager
Интегрируется с главным UI менеджером для:
- Переключения между режимами
- Отображения соответствующего UI
- Обработки событий

### PartManipulator
Работает с системой манипуляций для:
- Обнаружения деталей машины
- Подсчета количества деталей
- Мониторинга состояния деталей

## Настройка полигона

### Создание полигона в сцене

1. Создать пустой GameObject "TestPolygon"
2. Добавить компонент `TestPolygon`
3. Настроить параметры в инспекторе
4. Добавить материалы для земли и препятствий

### Настройка UI

1. Создать Canvas для UI тестирования
2. Добавить компонент `TestModeUI`
3. Настроить ссылки на UI элементы
4. Создать префабы для элементов целей

### Настройка машины

1. Создать GameObject для машины
2. Добавить компонент `VehicleController`
3. Настроить параметры машины
4. Добавить тег "Vehicle" для обнаружения

## События системы

### TestPolygon события

```csharp
// Изменение времени
OnTimeChanged(float time)

// Изменение счета
OnScoreChanged(float score)

// Изменение состояния теста
OnTestStateChanged(bool isActive)

// Завершение теста
OnTestCompleted()

// Провал теста
OnTestFailed()
```

### VehicleController события

```csharp
// Изменение скорости
OnSpeedChanged(float speed)

// Изменение здоровья
OnHealthChanged(float healthPercentage)

// Изменение состояния машины
OnVehicleStateChanged(bool isActive)

// Поломка машины
OnVehicleBroken()

// Запуск машины
OnVehicleStarted()
```

## Расширение системы

### Добавление новых типов целей

1. Добавить новый тип в enum `GoalType`
2. Реализовать проверку в методе `CheckGoals()`
3. Добавить соответствующую логику подсчета очков

### Добавление новых препятствий

1. Создать префаб препятствия
2. Добавить в список `obstacles`
3. Настроить коллайдеры и физику

### Кастомизация подсчета очков

1. Модифицировать метод `UpdateScore()`
2. Добавить новые множители
3. Реализовать дополнительные формулы

## Отладка и тестирование

### Логирование

Система выводит подробные логи:
- Инициализация компонентов
- Изменения состояния
- Завершение целей
- Ошибки и предупреждения

### Проверка состояния

```csharp
// Проверить состояние полигона
bool isActive = testPolygon.IsTestActive();
bool isCompleted = testPolygon.IsTestCompleted();

// Получить информацию о машине
string info = vehicleController.GetVehicleInfo();
float speed = vehicleController.GetCurrentSpeed();
```

## Производительность

### Оптимизации

- Использование Object Pooling для препятствий
- Кэширование компонентов
- Оптимизация проверок целей
- Минимизация вызовов Update

### Рекомендации

- Ограничить количество деталей машины
- Использовать LOD для препятствий
- Оптимизировать физические вычисления
- Минимизировать количество событий

## Заключение

Тестовый полигон предоставляет полную систему для тестирования машин в игре. Система легко расширяется и настраивается под различные потребности. Интеграция с другими системами обеспечивает плавную работу всего игрового процесса.
