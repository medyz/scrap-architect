# Система экономики и магазина

## Обзор

Система экономики обеспечивает игровой прогресс через валюту "Скрап" и магазин деталей. Игроки зарабатывают скрап, выполняя контракты, и тратят его на покупку новых деталей для строительства.

## Компоненты системы

### 1. EconomyManager - Менеджер экономики
**Файл:** `EconomyManager.cs`

Основной компонент, управляющий валютой и покупками.

**Основные функции:**
- Управление балансом скрапа
- Система цен на детали
- Разблокировка деталей
- Система распродаж
- Интеграция с контрактами

**Ключевые свойства:**
- `startingScrap` - Начальный баланс скрапа (1000)
- `maxScrap` - Максимальный баланс (999999)
- `discountMultiplier` - Множитель скидки (0.8)
- `enableSales` - Включение распродаж
- `saleChance` - Шанс распродажи (10%)
- `saleDuration` - Длительность распродажи (5 минут)

**Система цен:**
- **Блоки:** 50-100 скрапа
- **Колеса:** 150-500 скрапа
- **Двигатели:** 300-1500 скрапа
- **Соединения:** 25-150 скрапа
- **Сиденья:** 200-1000 скрапа
- **Инструменты:** 75-500 скрапа

### 2. ShopManager - Менеджер магазина
**Файл:** `ShopManager.cs`

Управляет отображением и интерфейсом магазина.

**Основные функции:**
- Отображение доступных деталей
- Категоризация деталей
- Фильтрация по цене
- Обновление UI при изменениях
- Интеграция с EconomyManager

**Категории деталей:**
- **Blocks** - Блоки (деревянные, металлические, пластиковые, каменные)
- **Wheels** - Колеса (маленькие, средние, большие, внедорожные)
- **Motors** - Двигатели (электрические, бензиновые, дизельные, реактивные)
- **Joints** - Соединения (жесткие, шарнирные, пружинные, ползунковые, настраиваемые)
- **Seats** - Сиденья (базовые, комфортные, гоночные, люксовые, промышленные)
- **Tools** - Инструменты (молотки, ключи, отвертки, дрели, сварщики, магниты, пылесосы, распылители)

### 3. ShopItem - UI элемент предмета
**Файл:** `ShopItem.cs`

Отображает отдельный предмет в магазине.

**Основные функции:**
- Отображение информации о предмете
- Кнопки покупки и информации
- Индикация распродаж
- Таймер распродажи
- Визуальная обратная связь

**Визуальные элементы:**
- **Название предмета** - Локализованное название
- **Цена** - Базовая и со скидкой
- **Описание** - Детальное описание функциональности
- **Иконка** - Цветовая индикация типа
- **Кнопка покупки** - Активна только при достаточном балансе
- **Бейдж распродажи** - Индикация активной скидки
- **Таймер** - Оставшееся время распродажи

## Процесс работы с экономикой

### 1. Заработок скрапа
1. **Выполнение контрактов** - Основной источник дохода
2. **Бонусы за скорость** - Дополнительные награды за быстрое выполнение
3. **Сложность контракта** - Более сложные контракты дают больше скрапа
4. **Множители** - Специальные события могут увеличивать доход

### 2. Покупка деталей
1. **Просмотр магазина** - Открытие панели магазина
2. **Выбор категории** - Фильтрация по типу деталей
3. **Проверка цены** - Сравнение с текущим балансом
4. **Покупка** - Списание скрапа и разблокировка детали
5. **Использование** - Деталь становится доступной в строительстве

### 3. Система распродаж
1. **Случайные распродажи** - Автоматическое начало скидок
2. **Временные ограничения** - Распродажи длятся 5 минут
3. **Визуальная индикация** - Бейджи и таймеры
4. **Автоматическое обновление** - UI обновляется при изменениях

## Интеграция с другими системами

### ContractManager
- Получение наград за выполнение контрактов
- Автоматическое добавление скрапа в баланс
- Интеграция с системой прогресса

### UIManager
- Отображение текущего баланса скрапа
- Переключение между панелями (строительство, магазин, контракты)
- Обновление UI при изменениях

### PartController
- Проверка доступности деталей для строительства
- Разблокировка новых возможностей
- Интеграция с системой snap-points

### GameManager
- Управление состоянием игры
- Сохранение прогресса экономики
- Переключение между режимами

## Оптимизация

### Производительность
- **Кэширование цен** - Избежание повторных вычислений
- **Оптимизированные обновления** - Обновление только измененных элементов
- **Событийная система** - Использование событий вместо постоянных проверок

### Память
- **Переиспользование UI элементов** - Пул объектов для ShopItem
- **Эффективное хранение данных** - Оптимизированные структуры данных
- **Очистка неиспользуемых ресурсов** - Автоматическая очистка

## Расширения

### Новые типы валют
1. Добавить новые типы валют (золото, кристаллы, очки репутации)
2. Система обмена валют
3. Специальные магазины для разных валют

### Система подписок
- Ежемесячная подписка с бонусами
- Премиум-валюта
- Эксклюзивные детали

### Система достижений
- Награды за покупки
- Скидки за достижения
- Бонусы за коллекционирование

### Мультиплеер
- Торговля между игроками
- Аукционы деталей
- Совместные покупки

## Отладка

### Логирование
- Подробные логи всех транзакций
- Отслеживание изменений баланса
- Статистика покупок и продаж

### Инспектор
- Визуализация состояния экономики
- Возможность ручного управления балансом
- Тестовые функции для распродаж

### Тестирование
- Unit тесты для основных функций
- Интеграционные тесты с UI
- Стресс-тесты для больших сумм

## Балансировка

### Принципы ценообразования
- **Доступность** - Базовые детали должны быть доступны новичкам
- **Прогрессия** - Цены растут с улучшением деталей
- **Сбалансированность** - Цены должны соответствовать полезности
- **Мотивация** - Цены должны мотивировать к выполнению контрактов

### Настройка распродаж
- **Частота** - Не слишком часто, чтобы сохранить ценность
- **Размер скидки** - Достаточно для мотивации, но не ломает экономику
- **Длительность** - Время для принятия решения, но не слишком долго

### Экономические циклы
- **Инфляция** - Постепенное увеличение цен
- **Дефляция** - Специальные события со скидками
- **Стабильность** - Поддержание баланса между зарабатыванием и тратами
